<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ­£å¿µé¥®é£Ÿç»ƒä¹  - MindFit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#4A6157",
            secondary: "#F7F6F2", 
            accent: "#2E2E2E",
            mint: "#8FD9A8",
            light: "#FAFAFA",
            white: "#FFFFFF",
            content: "#444444",
            gray: "#666666",
            lightGray: "#777777",
          },
        },
      },
    };
  </script>
  
  <style>
    /* é¡µé¢åŠ è½½åŠ¨ç”» */
    .page-content {
      opacity: 0;
      transform: translateY(30px);
      animation: fadeInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.2s forwards;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* æ­¥éª¤å¡ç‰‡åŠ¨ç”» */
    .step-card {
      transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      opacity: 0.5;
      transform: scale(0.95);
    }

    .step-card.active {
      opacity: 1;
      transform: scale(1);
      box-shadow: 0 8px 25px rgba(74, 97, 87, 0.2);
    }

    .step-card.completed {
      opacity: 0.7;
      transform: scale(0.98);
    }

    /* æŒ‰é’®æ ·å¼ */
    .btn-primary {
      background: linear-gradient(135deg, #4A6157, #8FD9A8);
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: 0 4px 20px rgba(74, 97, 87, 0.2);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 8px 30px rgba(74, 97, 87, 0.3);
    }

    .btn-secondary {
      border: 2px solid #4A6157;
      color: #4A6157;
      transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    
    .btn-secondary:hover {
      background: #8FD9A8;
      border-color: #8FD9A8;
      color: white;
      transform: translateY(-2px);
    }

    /* è¿›åº¦æ¡ */
    .progress-bar {
      transition: width 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      background: linear-gradient(90deg, #4A6157, #8FD9A8);
    }

    /* è®¡æ—¶å™¨åœ†åœˆ */
    .timer-circle {
      stroke-dasharray: 251;
      stroke-dashoffset: 251;
      transition: stroke-dashoffset 1s ease;
    }

    /* é£Ÿç‰©å›¾æ ‡åŠ¨ç”» */
    .food-icon {
      transition: all 0.3s ease;
    }

    .food-icon:hover {
      transform: scale(1.1);
    }

    /* åæ€åŒºåŸŸ */
    .reflection-area {
      background: linear-gradient(135deg, rgba(143, 217, 168, 0.1), rgba(74, 97, 87, 0.05));
      border: 1px solid rgba(143, 217, 168, 0.3);
    }

    /* Toast æ ·å¼ */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(135deg, #4A6157, #8FD9A8);
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      z-index: 1000;
      transform: translateX(120%);
      transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
      box-shadow: 0 8px 32px rgba(74, 97, 87, 0.3);
    }

    .toast.show {
      transform: translateX(0);
    }

    /* éŸ³é¢‘æ§åˆ¶æ ·å¼ */
    .audio-controls {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(74, 97, 87, 0.2);
    }

    /* å½©å¸¦åº†ç¥åŠ¨ç”» */
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #f0f;
      animation: confetti-fall 3s linear infinite;
      z-index: 9999;
    }

    .confetti:nth-child(1) { 
      background: #ff6b6b; 
      left: 10%; 
      animation-delay: 0s;
      animation-duration: 3s;
    }
    .confetti:nth-child(2) { 
      background: #4ecdc4; 
      left: 20%; 
      animation-delay: 0.5s;
      animation-duration: 2.5s;
    }
    .confetti:nth-child(3) { 
      background: #45b7d1; 
      left: 30%; 
      animation-delay: 1s;
      animation-duration: 3.5s;
    }
    .confetti:nth-child(4) { 
      background: #f9ca24; 
      left: 40%; 
      animation-delay: 0.3s;
      animation-duration: 2.8s;
    }
    .confetti:nth-child(5) { 
      background: #f0932b; 
      left: 50%; 
      animation-delay: 0.7s;
      animation-duration: 3.2s;
    }
    .confetti:nth-child(6) { 
      background: #eb4d4b; 
      left: 60%; 
      animation-delay: 1.2s;
      animation-duration: 2.7s;
    }
    .confetti:nth-child(7) { 
      background: #6c5ce7; 
      left: 70%; 
      animation-delay: 0.2s;
      animation-duration: 3.1s;
    }
    .confetti:nth-child(8) { 
      background: #a29bfe; 
      left: 80%; 
      animation-delay: 0.9s;
      animation-duration: 2.9s;
    }
    .confetti:nth-child(9) { 
      background: #fd79a8; 
      left: 90%; 
      animation-delay: 1.5s;
      animation-duration: 3.3s;
    }
    .confetti:nth-child(10) { 
      background: #00b894; 
      left: 15%; 
      animation-delay: 0.4s;
      animation-duration: 2.6s;
    }

    @keyframes confetti-fall {
      0% {
        transform: translateY(-100vh) rotate(0deg);
        opacity: 1;
      }
      10% {
        transform: translateY(-90vh) rotate(36deg);
        opacity: 1;
      }
      20% {
        transform: translateY(-80vh) rotate(72deg);
        opacity: 1;
      }
      30% {
        transform: translateY(-70vh) rotate(108deg);
        opacity: 1;
      }
      40% {
        transform: translateY(-60vh) rotate(144deg);
        opacity: 1;
      }
      50% {
        transform: translateY(-50vh) rotate(180deg);
        opacity: 1;
      }
      60% {
        transform: translateY(-40vh) rotate(216deg);
        opacity: 1;
      }
      70% {
        transform: translateY(-30vh) rotate(252deg);
        opacity: 1;
      }
      80% {
        transform: translateY(-20vh) rotate(288deg);
        opacity: 0.8;
      }
      90% {
        transform: translateY(-10vh) rotate(324deg);
        opacity: 0.5;
      }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }

    /* å½©å¸¦çš„ä¸åŒå½¢çŠ¶ */
    .confetti.square {
      border-radius: 0;
    }
    .confetti.circle {
      border-radius: 50%;
    }
    .confetti.triangle {
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-bottom: 10px solid;
    }
  </style>
</head>

<body class="bg-secondary font-sans min-h-screen">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <nav class="bg-white border-b border-gray-200 sticky top-0 z-50 backdrop-blur-md bg-white/90">
    <div class="max-w-4xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <a href="daily_practice.html" class="flex items-center text-primary hover:text-mint transition-all duration-300 group">
            <span class="mr-2 transition-transform group-hover:-translate-x-1">â†</span>
            <span class="font-medium">è¿”å›ç»ƒä¹ </span>
          </a>
        </div>
        <div class="flex items-center space-x-2">
          <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center">
            <i class="fa fa-apple text-white text-sm"></i>
          </div>
          <span class="text-lg font-bold text-primary">æ­£å¿µé¥®é£Ÿ</span>
        </div>
      </div>
    </div>
  </nav>

  <!-- Toast æç¤º -->
  <div id="toast" class="toast">
    <div class="flex items-center">
      <span class="mr-2">âœ“</span>
      <span id="toastMessage"></span>
    </div>
  </div>

  <main class="max-w-4xl mx-auto px-4 py-8">
    <div class="page-content">
      
      <!-- é¡µé¢æ ‡é¢˜ -->
      <div class="text-center mb-8">
        <h1 class="text-2xl md:text-3xl font-bold text-primary mb-2">æ­£å¿µé¥®é£Ÿç»ƒä¹ </h1>
        <p class="text-content">æ…¢ä¸€ç‚¹ï¼Œå’Œå‘³é“å¥½å¥½ç›¸å¤„</p>
      </div>

      <!-- ç»ƒä¹ è¿›åº¦ -->
      <div class="bg-white rounded-2xl p-6 shadow-sm mb-8">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-primary">ç»ƒä¹ è¿›åº¦</h2>
          <span class="text-sm text-gray-500" id="progressText">0/5 æ­¥éª¤</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-3">
          <div id="progressBar" class="progress-bar h-3 rounded-full" style="width: 0%"></div>
        </div>
      </div>

      <!-- é€‰æ‹©é£Ÿç‰© -->
      <div id="foodSelection" class="bg-white rounded-2xl p-6 shadow-sm mb-6">
        <h3 class="text-xl font-semibold text-primary mb-4">ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©ä½ çš„é£Ÿç‰©</h3>
        <p class="text-gray-600 mb-6">é€‰æ‹©ä¸€ç§å°ä»½é‡çš„é£Ÿç‰©å¼€å§‹æ­£å¿µé¥®é£Ÿç»ƒä¹ ï¼š</p>
        
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="food-option text-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-primary transition-all" data-food="è‘¡è„å¹²">
            <div class="food-icon text-4xl mb-2">ğŸ‡</div>
            <div class="text-sm font-medium">è‘¡è„å¹²</div>
          </div>
          <div class="food-option text-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-primary transition-all" data-food="åšæœ">
            <div class="food-icon text-4xl mb-2">ğŸ¥œ</div>
            <div class="text-sm font-medium">åšæœ</div>
          </div>
          <div class="food-option text-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-primary transition-all" data-food="å·§å…‹åŠ›">
            <div class="food-icon text-4xl mb-2">ğŸ«</div>
            <div class="text-sm font-medium">å·§å…‹åŠ›</div>
          </div>
          <div class="food-option text-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-primary transition-all" data-food="å…¶ä»–">
            <div class="food-icon text-4xl mb-2">ğŸ½ï¸</div>
            <div class="text-sm font-medium">å…¶ä»–</div>
          </div>
        </div>

        <div class="text-center">
          <button id="startPracticeBtn" class="btn-primary text-white px-8 py-3 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            å¼€å§‹ç»ƒä¹ 
          </button>
        </div>
      </div>

      <!-- ç»ƒä¹ æ­¥éª¤ -->
      <div id="practiceSteps" class="space-y-6 hidden">
        
        <!-- æ­¥éª¤1ï¼šè§‚å¯Ÿ -->
        <div class="step-card bg-white rounded-2xl p-6 shadow-sm" data-step="1">
          <div class="flex items-center mb-4">
            <div class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mr-4 font-bold">1</div>
            <h3 class="text-xl font-semibold text-primary">ä»”ç»†è§‚å¯Ÿ</h3>
          </div>
          
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <p class="text-gray-600 mb-4">èŠ±2åˆ†é’Ÿæ—¶é—´ä»”ç»†è§‚å¯Ÿä½ é€‰æ‹©çš„é£Ÿç‰©ï¼š</p>
              <ul class="text-sm text-gray-600 space-y-2 mb-4">
                <li>â€¢ æ³¨æ„å®ƒçš„é¢œè‰²ã€å½¢çŠ¶å’Œå¤§å°</li>
                <li>â€¢ è§‚å¯Ÿè¡¨é¢çš„è´¨åœ°å’Œçº¹ç†</li>
                <li>â€¢ çœ‹çœ‹å®ƒåœ¨å…‰çº¿ä¸‹çš„æ ·å­</li>
                <li>â€¢ æ³¨æ„ä»»ä½•ç‹¬ç‰¹çš„ç‰¹å¾</li>
              </ul>
            </div>
            
            <div class="text-center">
              <div class="relative w-24 h-24 mx-auto mb-4">
                <svg class="w-24 h-24 transform -rotate-90">
                  <circle cx="48" cy="48" r="40" stroke="#e5e7eb" stroke-width="6" fill="none"/>
                  <circle id="timer1" cx="48" cy="48" r="40" stroke="#4A6157" stroke-width="6" fill="none" 
                          class="timer-circle"/>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                  <span id="timerDisplay1" class="text-lg font-bold text-primary">2:00</span>
                </div>
              </div>
              <button id="startStep1" class="btn-secondary px-4 py-2 rounded-lg text-sm">
                <i class="fa fa-play mr-2"></i>å¼€å§‹è§‚å¯Ÿ
              </button>
            </div>
          </div>
          
          <div class="mt-6 p-4 bg-gray-50 rounded-lg">
            <label class="block text-sm font-medium text-gray-700 mb-2">è®°å½•ä½ è§‚å¯Ÿåˆ°çš„ï¼š</label>
            <textarea id="observation" rows="3" class="w-full p-3 border border-gray-300 rounded-lg resize-none" 
                      placeholder="ä¾‹å¦‚ï¼šè‘¡è„å¹²å‘ˆæ·±ç´«è‰²ï¼Œè¡¨é¢æœ‰ç»†å°çš„çš±çº¹..."></textarea>
          </div>
        </div>

        <!-- æ­¥éª¤2ï¼šå—…è§‰ -->
        <div class="step-card bg-white rounded-2xl p-6 shadow-sm" data-step="2">
          <div class="flex items-center mb-4">
            <div class="w-10 h-10 rounded-full bg-green-100 text-green-600 flex items-center justify-center mr-4 font-bold">2</div>
            <h3 class="text-xl font-semibold text-primary">æ„Ÿå—é¦™å‘³</h3>
          </div>
          
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <p class="text-gray-600 mb-4">å°†é£Ÿç‰©é è¿‘é¼»å­ï¼ŒèŠ±1åˆ†é’Ÿæ„Ÿå—å®ƒçš„é¦™å‘³ï¼š</p>
              <ul class="text-sm text-gray-600 space-y-2 mb-4">
                <li>â€¢ æ·±æ·±å¸æ°”ï¼Œæ„Ÿå—é£Ÿç‰©çš„æ°”å‘³</li>
                <li>â€¢ æ³¨æ„é¦™å‘³çš„å¼ºåº¦å’Œå±‚æ¬¡</li>
                <li>â€¢ è§‚å¯Ÿå—…è§‰å¦‚ä½•å½±å“ä½ çš„æ„Ÿå—</li>
                <li>â€¢ æ˜¯å¦å”¤èµ·äº†æŸäº›è®°å¿†æˆ–æƒ…æ„Ÿï¼Ÿ</li>
              </ul>
            </div>
            
            <div class="text-center">
              <div class="relative w-24 h-24 mx-auto mb-4">
                <svg class="w-24 h-24 transform -rotate-90">
                  <circle cx="48" cy="48" r="40" stroke="#e5e7eb" stroke-width="6" fill="none"/>
                  <circle id="timer2" cx="48" cy="48" r="40" stroke="#8FD9A8" stroke-width="6" fill="none" 
                          class="timer-circle"/>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                  <span id="timerDisplay2" class="text-lg font-bold text-primary">1:00</span>
                </div>
              </div>
              <button id="startStep2" class="btn-secondary px-4 py-2 rounded-lg text-sm" disabled>
                <i class="fa fa-play mr-2"></i>å¼€å§‹æ„Ÿå—
              </button>
            </div>
          </div>
          
          <div class="mt-6 p-4 bg-gray-50 rounded-lg">
            <label class="block text-sm font-medium text-gray-700 mb-2">è®°å½•ä½ æ„Ÿå—åˆ°çš„é¦™å‘³ï¼š</label>
            <textarea id="smell" rows="2" class="w-full p-3 border border-gray-300 rounded-lg resize-none" 
                      placeholder="ä¾‹å¦‚ï¼šæ·¡æ·¡çš„ç”œå‘³ï¼Œå¸¦æœ‰ä¸€ä¸æœé¦™..."></textarea>
          </div>
        </div>

        <!-- æ­¥éª¤3ï¼šè§¦è§‰ -->
        <div class="step-card bg-white rounded-2xl p-6 shadow-sm" data-step="3">
          <div class="flex items-center mb-4">
            <div class="w-10 h-10 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center mr-4 font-bold">3</div>
            <h3 class="text-xl font-semibold text-primary">æ„Ÿå—è´¨åœ°</h3>
          </div>
          
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <p class="text-gray-600 mb-4">ç”¨æ‰‹æŒ‡è½»è½»è§¦æ‘¸é£Ÿç‰©ï¼Œæ„Ÿå—å®ƒçš„è´¨åœ°ï¼š</p>
              <ul class="text-sm text-gray-600 space-y-2 mb-4">
                <li>â€¢ æ³¨æ„é£Ÿç‰©çš„è½¯ç¡¬ç¨‹åº¦</li>
                <li>â€¢ æ„Ÿå—è¡¨é¢çš„çº¹ç†å’Œæ¸©åº¦</li>
                <li>â€¢ è§‚å¯Ÿé‡é‡å’Œå¯†åº¦</li>
                <li>â€¢ æ³¨æ„è§¦æ‘¸æ—¶çš„æ„Ÿè§‰</li>
              </ul>
            </div>
            
            <div class="text-center">
              <div class="text-6xl mb-4">âœ‹</div>
              <button id="completeStep3" class="btn-secondary px-4 py-2 rounded-lg text-sm" disabled>
                å®Œæˆè§¦æ‘¸
              </button>
            </div>
          </div>
          
          <div class="mt-6 p-4 bg-gray-50 rounded-lg">
            <label class="block text-sm font-medium text-gray-700 mb-2">è®°å½•ä½ æ„Ÿå—åˆ°çš„è´¨åœ°ï¼š</label>
            <textarea id="texture" rows="2" class="w-full p-3 border border-gray-300 rounded-lg resize-none" 
                      placeholder="ä¾‹å¦‚ï¼šè¡¨é¢æœ‰äº›ç²—ç³™ï¼Œè´¨åœ°è¾ƒç¡¬..."></textarea>
          </div>
        </div>

        <!-- æ­¥éª¤4ï¼šå“å° -->
        <div class="step-card bg-white rounded-2xl p-6 shadow-sm" data-step="4">
          <div class="flex items-center mb-4">
            <div class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center mr-4 font-bold">4</div>
            <h3 class="text-xl font-semibold text-primary">æ…¢æ…¢å“å°</h3>
          </div>
          
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <p class="text-gray-600 mb-4">å°†é£Ÿç‰©æ”¾å…¥å£ä¸­ï¼Œæ…¢æ…¢å’€åš¼3åˆ†é’Ÿï¼š</p>
              <ul class="text-sm text-gray-600 space-y-2 mb-4">
                <li>â€¢ ç¬¬ä¸€å£ï¼šæ³¨æ„åˆå§‹çš„å‘³é“</li>
                <li>â€¢ æ…¢æ…¢å’€åš¼ï¼Œæ„Ÿå—å‘³é“çš„å˜åŒ–</li>
                <li>â€¢ æ³¨æ„å£æ„Ÿå’Œè´¨åœ°çš„å˜åŒ–</li>
                <li>â€¢ è§‚å¯Ÿåå’½æ—¶çš„æ„Ÿè§‰</li>
              </ul>
            </div>
            
            <div class="text-center">
              <div class="relative w-24 h-24 mx-auto mb-4">
                <svg class="w-24 h-24 transform -rotate-90">
                  <circle cx="48" cy="48" r="40" stroke="#e5e7eb" stroke-width="6" fill="none"/>
                  <circle id="timer4" cx="48" cy="48" r="40" stroke="#A855F7" stroke-width="6" fill="none" 
                          class="timer-circle"/>
                </svg>
                <div class="absolute inset-0 flex items-center justify-center">
                  <span id="timerDisplay4" class="text-lg font-bold text-primary">3:00</span>
                </div>
              </div>
              <button id="startStep4" class="btn-secondary px-4 py-2 rounded-lg text-sm" disabled>
                <i class="fa fa-play mr-2"></i>å¼€å§‹å“å°
              </button>
            </div>
          </div>
          
          <div class="mt-6 p-4 bg-gray-50 rounded-lg">
            <label class="block text-sm font-medium text-gray-700 mb-2">è®°å½•å‘³è§‰ä½“éªŒï¼š</label>
            <textarea id="taste" rows="3" class="w-full p-3 border border-gray-300 rounded-lg resize-none" 
                      placeholder="ä¾‹å¦‚ï¼šå¼€å§‹æœ‰æ·¡æ·¡çš„ç”œå‘³ï¼Œå’€åš¼åå˜å¾—æ›´åŠ æµ“éƒ..."></textarea>
          </div>
        </div>

        <!-- æ­¥éª¤5ï¼šåæ€ -->
        <div class="step-card bg-white rounded-2xl p-6 shadow-sm" data-step="5">
          <div class="flex items-center mb-4">
            <div class="w-10 h-10 rounded-full bg-pink-100 text-pink-600 flex items-center justify-center mr-4 font-bold">5</div>
            <h3 class="text-xl font-semibold text-primary">ç»ƒä¹ åæ€</h3>
          </div>
          
          <div class="reflection-area rounded-lg p-6">
            <p class="text-gray-600 mb-6">èŠ±å‡ åˆ†é’Ÿæ—¶é—´åæ€è¿™æ¬¡æ­£å¿µé¥®é£Ÿçš„ä½“éªŒï¼š</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">1. ä¸å¹³å¸¸çš„é¥®é£Ÿä½“éªŒç›¸æ¯”ï¼Œä½ æ³¨æ„åˆ°äº†ä»€ä¹ˆä¸åŒï¼Ÿ</label>
                <textarea id="reflection1" rows="2" class="w-full p-3 border border-gray-300 rounded-lg resize-none"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">2. è¿™ç§æ…¢æ…¢å“å°çš„æ–¹å¼è®©ä½ æœ‰ä»€ä¹ˆæ„Ÿå—ï¼Ÿ</label>
                <textarea id="reflection2" rows="2" class="w-full p-3 border border-gray-300 rounded-lg resize-none"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">3. ä½ æ„¿æ„åœ¨æ—¥å¸¸é¥®é£Ÿä¸­å°è¯•è¿™ç§æ–¹å¼å—ï¼Ÿ</label>
                <textarea id="reflection3" rows="2" class="w-full p-3 border border-gray-300 rounded-lg resize-none"></textarea>
              </div>
            </div>
          </div>
          
          <div class="text-center mt-6">
            <button id="completePractice" class="btn-primary text-white px-8 py-3 rounded-lg font-medium">
              å®Œæˆç»ƒä¹ 
            </button>
          </div>
        </div>

      </div>

      <!-- ç»ƒä¹ å®Œæˆ -->
      <div id="practiceComplete" class="bg-white rounded-2xl p-8 shadow-sm text-center hidden">
        <div class="text-6xl mb-4">ğŸ‰</div>
        <h2 class="text-2xl font-bold text-primary mb-4">æ­å–œå®Œæˆæ­£å¿µé¥®é£Ÿç»ƒä¹ ï¼</h2>
        <p class="text-gray-600 mb-6">ä½ å·²ç»ä½“éªŒäº†ç”¨å…¨æ–°çš„æ–¹å¼ä¸é£Ÿç‰©ç›¸å¤„ã€‚è¿™ç§è§‰å¯Ÿå’Œä¸“æ³¨å¯ä»¥å¸®åŠ©ä½ å»ºç«‹æ›´å¥åº·çš„é¥®é£Ÿå…³ç³»ã€‚</p>
        
        <div class="grid md:grid-cols-3 gap-4 mb-6">
          <div class="p-4 bg-green-50 rounded-lg">
            <div class="text-2xl mb-2">ğŸ§˜</div>
            <div class="text-sm font-medium text-green-700">å¢å¼ºè§‰å¯ŸåŠ›</div>
          </div>
          <div class="p-4 bg-blue-50 rounded-lg">
            <div class="text-2xl mb-2">ğŸ’š</div>
            <div class="text-sm font-medium text-blue-700">æ”¹å–„é£Ÿç‰©å…³ç³»</div>
          </div>
          <div class="p-4 bg-purple-50 rounded-lg">
            <div class="text-2xl mb-2">âš–ï¸</div>
            <div class="text-sm font-medium text-purple-700">å¹³è¡¡é¥®é£Ÿä¹ æƒ¯</div>
          </div>
        </div>
        
        <div class="flex flex-col md:flex-row gap-4 justify-center">
          <button onclick="savePracticeRecord()" class="btn-primary text-white px-6 py-3 rounded-lg">
            <i class="fa fa-save mr-2"></i>ä¿å­˜è®°å½•
          </button>
          <button onclick="restartPractice()" class="btn-secondary px-6 py-3 rounded-lg">
            <i class="fa fa-refresh mr-2"></i>å†æ¬¡ç»ƒä¹ 
          </button>
          <button onclick="window.location.href='daily_practice.html'" class="btn-secondary px-6 py-3 rounded-lg">
            <i class="fa fa-arrow-left mr-2"></i>è¿”å›ç»ƒä¹ 
          </button>
        </div>
      </div>

    </div>
  </main>

  <!-- èƒŒæ™¯éŸ³ä¹æ§åˆ¶ -->
  <div class="audio-controls fixed bottom-4 right-4 rounded-lg p-3 shadow-lg">
    <div class="flex items-center space-x-3">
      <button id="audioToggle" class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center">
        <i class="fa fa-music"></i>
      </button>
      <div class="hidden md:block">
        <div class="text-xs text-gray-600">èƒŒæ™¯éŸ³ä¹</div>
        <input type="range" id="volumeControl" min="0" max="100" value="50" class="w-16">
      </div>
    </div>
  </div>

  <!-- éšè—çš„éŸ³é¢‘å…ƒç´  -->
  <audio id="backgroundAudio" loop>
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmQpF1O66+KdSgwJU6Xd7M2mXgcOXbDn7qJQFQw=" type="audio/wav">
  </audio>

  <script>
    // å…¨å±€å˜é‡
    let currentStep = 0;
    let selectedFood = '';
    let stepTimers = {};
    let practiceStartTime = null;
    let backgroundAudioEnabled = false;

    // æ­£å¿µé¥®é£Ÿç»ƒä¹ æ•°æ®ç»“æ„
    let practiceData = {
      food: '',
      startTime: null,
      endTime: null,
      observations: {
        visual: '',
        smell: '',
        texture: '',
        taste: '',
        reflections: []
      }
    };

    // Toast æç¤ºåŠŸèƒ½
    function showToast(message) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      toastMessage.textContent = message;
      toast.classList.add('show');
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // å½©å¸¦åº†ç¥åŠ¨ç”»
    function showConfettiCelebration() {
      // åˆ›å»ºå½©å¸¦å®¹å™¨
      const confettiContainer = document.createElement('div');
      confettiContainer.style.position = 'fixed';
      confettiContainer.style.top = '0';
      confettiContainer.style.left = '0';
      confettiContainer.style.width = '100%';
      confettiContainer.style.height = '100%';
      confettiContainer.style.pointerEvents = 'none';
      confettiContainer.style.zIndex = '9999';
      
      // åˆ›å»ºå¤šä¸ªå½©å¸¦
      const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7', '#a29bfe', '#fd79a8', '#00b894'];
      const shapes = ['square', 'circle', 'triangle'];
      
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = `confetti ${shapes[Math.floor(Math.random() * shapes.length)]}`;
        
        // éšæœºä½ç½®å’Œé¢œè‰²
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 2 + 's';
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        
        // éšæœºå¤§å°
        const size = Math.random() * 8 + 4;
        confetti.style.width = size + 'px';
        confetti.style.height = size + 'px';
        
        // ä¸‰è§’å½¢ç‰¹æ®Šå¤„ç†
        if (confetti.classList.contains('triangle')) {
          confetti.style.borderBottomColor = confetti.style.backgroundColor;
          confetti.style.backgroundColor = 'transparent';
        }
        
        confettiContainer.appendChild(confetti);
      }
      
      document.body.appendChild(confettiContainer);
      
      // 4ç§’åæ¸…é™¤å½©å¸¦
      setTimeout(() => {
        if (document.body.contains(confettiContainer)) {
          document.body.removeChild(confettiContainer);
        }
      }, 4000);
      
      // æ’­æ”¾åº†ç¥éŸ³æ•ˆï¼ˆå¦‚æœæ”¯æŒï¼‰
      playSuccessSound();
    }

    // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
    function playSuccessSound() {
      try {
        // åˆ›å»ºç®€å•çš„æˆåŠŸéŸ³æ•ˆ
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // åˆ›å»ºéŸ³ç¬¦åºåˆ—ï¼ˆCå¤§è°ƒå’Œå¼¦ï¼‰
        const notes = [523.25, 659.25, 783.99]; // C5, E5, G5
        
        notes.forEach((freq, index) => {
          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(audioContext.destination);
          
          oscillator.frequency.value = freq;
          oscillator.type = 'sine';
          
          gainNode.gain.setValueAtTime(0, audioContext.currentTime + index * 0.1);
          gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + index * 0.1 + 0.05);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + index * 0.1 + 0.3);
          
          oscillator.start(audioContext.currentTime + index * 0.1);
          oscillator.stop(audioContext.currentTime + index * 0.1 + 0.3);
        });
      } catch (error) {
        console.log('Audio not supported');
      }
    }

    // æ›´æ–°è¿›åº¦æ¡
    function updateProgress() {
      const progress = (currentStep / 5) * 100;
      document.getElementById('progressBar').style.width = `${progress}%`;
      document.getElementById('progressText').textContent = `${currentStep}/5 æ­¥éª¤`;
    }

    // æ›´æ–°æ­¥éª¤çŠ¶æ€
    function updateStepStates() {
      document.querySelectorAll('.step-card').forEach((card, index) => {
        const stepNum = index + 1;
        card.classList.remove('active', 'completed');
        
        if (stepNum < currentStep) {
          card.classList.add('completed');
        } else if (stepNum === currentStep) {
          card.classList.add('active');
        }
      });
    }

    // é£Ÿç‰©é€‰æ‹©å¤„ç†
    function initFoodSelection() {
      document.querySelectorAll('.food-option').forEach(option => {
        option.addEventListener('click', () => {
          // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
          document.querySelectorAll('.food-option').forEach(opt => {
            opt.classList.remove('border-primary', 'bg-primary/5');
            opt.classList.add('border-gray-200');
          });
          
          // æ ‡è®°å½“å‰é€‰æ‹©
          option.classList.remove('border-gray-200');
          option.classList.add('border-primary', 'bg-primary/5');
          
          selectedFood = option.dataset.food;
          practiceData.food = selectedFood;
          
          // å¯ç”¨å¼€å§‹æŒ‰é’®
          document.getElementById('startPracticeBtn').disabled = false;
        });
      });
      
      document.getElementById('startPracticeBtn').addEventListener('click', startPractice);
    }

    // å¼€å§‹ç»ƒä¹ 
    function startPractice() {
      if (!selectedFood) {
        showToast('è¯·å…ˆé€‰æ‹©ä¸€ç§é£Ÿç‰©');
        return;
      }
      
      practiceData.startTime = new Date().toISOString();
      practiceStartTime = Date.now();
      
      // éšè—é£Ÿç‰©é€‰æ‹©ï¼Œæ˜¾ç¤ºç»ƒä¹ æ­¥éª¤
      document.getElementById('foodSelection').classList.add('hidden');
      document.getElementById('practiceSteps').classList.remove('hidden');
      
      currentStep = 1;
      updateProgress();
      updateStepStates();
      
      showToast(`å¼€å§‹æ­£å¿µé¥®é£Ÿç»ƒä¹ ï¼š${selectedFood}`);
      initStepHandlers();
    }

    // åˆå§‹åŒ–æ­¥éª¤å¤„ç†å™¨
    function initStepHandlers() {
      // æ­¥éª¤1ï¼šè§‚å¯Ÿ
      document.getElementById('startStep1').addEventListener('click', () => {
        startStepTimer('timer1', 'timerDisplay1', 120, () => {
          // ä¿å­˜è§‚å¯Ÿè®°å½•
          practiceData.observations.visual = document.getElementById('observation').value;
          completeStep(1);
        });
      });

      // æ­¥éª¤2ï¼šå—…è§‰
      document.getElementById('startStep2').addEventListener('click', () => {
        startStepTimer('timer2', 'timerDisplay2', 60, () => {
          practiceData.observations.smell = document.getElementById('smell').value;
          completeStep(2);
        });
      });

      // æ­¥éª¤3ï¼šè§¦è§‰
      document.getElementById('completeStep3').addEventListener('click', () => {
        practiceData.observations.texture = document.getElementById('texture').value;
        completeStep(3);
      });

      // æ­¥éª¤4ï¼šå“å°
      document.getElementById('startStep4').addEventListener('click', () => {
        startStepTimer('timer4', 'timerDisplay4', 180, () => {
          practiceData.observations.taste = document.getElementById('taste').value;
          completeStep(4);
        });
      });

      // æ­¥éª¤5ï¼šåæ€
      document.getElementById('completePractice').addEventListener('click', () => {
        // ä¿å­˜åæ€
        practiceData.observations.reflections = [
          document.getElementById('reflection1').value,
          document.getElementById('reflection2').value,
          document.getElementById('reflection3').value
        ];
        completeStep(5);
        showPracticeComplete();
      });
    }

    // å¼€å§‹æ­¥éª¤è®¡æ—¶å™¨
    function startStepTimer(circleId, displayId, duration, onComplete) {
      const circle = document.getElementById(circleId);
      const display = document.getElementById(displayId);
      
      let timeLeft = duration;
      const circumference = 2 * Math.PI * 40;
      
      // é‡ç½®åœ†åœˆ
      circle.style.strokeDashoffset = circumference;
      
      const timer = setInterval(() => {
        timeLeft--;
        display.textContent = formatTime(timeLeft);
        
        // æ›´æ–°åœ†åœˆè¿›åº¦
        const progress = (duration - timeLeft) / duration;
        const offset = circumference - (progress * circumference);
        circle.style.strokeDashoffset = offset;
        
        if (timeLeft <= 0) {
          clearInterval(timer);
          onComplete();
        }
      }, 1000);
      
      stepTimers[circleId] = timer;
    }

    // å®Œæˆæ­¥éª¤
    function completeStep(stepNumber) {
      currentStep = stepNumber + 1;
      updateProgress();
      updateStepStates();
      
      // å¯ç”¨ä¸‹ä¸€æ­¥
      if (stepNumber < 5) {
        enableNextStep(stepNumber + 1);
      }
      
      showToast(`ç¬¬${stepNumber}æ­¥å®Œæˆï¼`);
    }

    // å¯ç”¨ä¸‹ä¸€æ­¥
    function enableNextStep(nextStep) {
      const stepButtons = {
        2: 'startStep2',
        3: 'completeStep3',
        4: 'startStep4',
        5: 'completePractice'
      };
      
      const buttonId = stepButtons[nextStep];
      if (buttonId) {
        document.getElementById(buttonId).disabled = false;
      }
    }

    // æ˜¾ç¤ºç»ƒä¹ å®Œæˆ
    function showPracticeComplete() {
      practiceData.endTime = new Date().toISOString();
      
      // éšè—æ­¥éª¤ï¼Œæ˜¾ç¤ºå®Œæˆé¡µé¢
      document.getElementById('practiceSteps').classList.add('hidden');
      document.getElementById('practiceComplete').classList.remove('hidden');
      
      // ğŸ‰ æ˜¾ç¤ºå½©å¸¦åº†ç¥åŠ¨ç”»
      showConfettiCelebration();
      
      // è®¡ç®—ç»ƒä¹ æ—¶é•¿
      const duration = Math.round((Date.now() - practiceStartTime) / 1000 / 60);
      showToast(`ç»ƒä¹ å®Œæˆï¼æ€»è€—æ—¶ ${duration} åˆ†é’Ÿ`);
    }

    // ä¿å­˜ç»ƒä¹ è®°å½•
    function savePracticeRecord() {
      const records = JSON.parse(localStorage.getItem('mindfulEatingRecords') || '[]');
      
      const record = {
        id: Date.now(),
        ...practiceData,
        duration: Math.round((Date.now() - practiceStartTime) / 1000 / 60)
      };
      
      records.push(record);
      localStorage.setItem('mindfulEatingRecords', JSON.stringify(records));
      
      showToast('ç»ƒä¹ è®°å½•å·²ä¿å­˜ï¼');
    }

    // é‡æ–°å¼€å§‹ç»ƒä¹ 
    function restartPractice() {
      // é‡ç½®æ‰€æœ‰çŠ¶æ€
      currentStep = 0;
      selectedFood = '';
      practiceData = {
        food: '',
        startTime: null,
        endTime: null,
        observations: {
          visual: '',
          smell: '',
          texture: '',
          taste: '',
          reflections: []
        }
      };
      
      // æ¸…ç©ºæ‰€æœ‰è¾“å…¥
      document.querySelectorAll('textarea').forEach(textarea => {
        textarea.value = '';
      });
      
      // é‡ç½®UI
      document.getElementById('practiceComplete').classList.add('hidden');
      document.getElementById('foodSelection').classList.remove('hidden');
      document.getElementById('practiceSteps').classList.add('hidden');
      
      // é‡ç½®é£Ÿç‰©é€‰æ‹©
      document.querySelectorAll('.food-option').forEach(opt => {
        opt.classList.remove('border-primary', 'bg-primary/5');
        opt.classList.add('border-gray-200');
      });
      
      document.getElementById('startPracticeBtn').disabled = true;
      
      // é‡ç½®æŒ‰é’®çŠ¶æ€
      ['startStep2', 'completeStep3', 'startStep4'].forEach(id => {
        document.getElementById(id).disabled = true;
      });
      
      updateProgress();
      showToast('ç»ƒä¹ å·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°å¼€å§‹');
    }

    // èƒŒæ™¯éŸ³ä¹æ§åˆ¶
    function initAudioControls() {
      const audioToggle = document.getElementById('audioToggle');
      const volumeControl = document.getElementById('volumeControl');
      const backgroundAudio = document.getElementById('backgroundAudio');
      
      audioToggle.addEventListener('click', () => {
        if (backgroundAudioEnabled) {
          backgroundAudio.pause();
          audioToggle.innerHTML = '<i class="fa fa-music"></i>';
          backgroundAudioEnabled = false;
        } else {
          backgroundAudio.play().catch(() => {
            showToast('æ— æ³•æ’­æ”¾èƒŒæ™¯éŸ³ä¹');
          });
          audioToggle.innerHTML = '<i class="fa fa-pause"></i>';
          backgroundAudioEnabled = true;
        }
      });
      
      volumeControl.addEventListener('input', (e) => {
        backgroundAudio.volume = e.target.value / 100;
      });
    }

    // é¡µé¢åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      initFoodSelection();
      initAudioControls();
      updateProgress();
      
      // æ¬¢è¿æç¤º
      setTimeout(() => {
        showToast('æ¬¢è¿æ¥åˆ°æ­£å¿µé¥®é£Ÿç»ƒä¹ ï¼è¯·é€‰æ‹©ä¸€ç§é£Ÿç‰©å¼€å§‹');
      }, 1000);
    });

    // é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        if (confirm('ç¡®å®šè¦é€€å‡ºç»ƒä¹ å—ï¼Ÿ')) {
          window.location.href = 'daily_practice.html';
        }
      }
    });

    // é˜²æ­¢æ„å¤–ç¦»å¼€
    window.addEventListener('beforeunload', (e) => {
      if (currentStep > 0 && currentStep < 5) {
        e.preventDefault();
        e.returnValue = 'ç»ƒä¹ è¿›è¡Œä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
      }
    });

    // è‡ªåŠ¨ä¿å­˜è‰ç¨¿
    function autoSave() {
      if (currentStep > 0) {
        const draft = {
          currentStep,
          selectedFood,
          practiceData,
          timestamp: Date.now()
        };
        localStorage.setItem('mindfulEatingDraft', JSON.stringify(draft));
      }
    }

    // æ¯30ç§’è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
    setInterval(autoSave, 30000);

    // é¡µé¢åŠ è½½æ—¶æ¢å¤è‰ç¨¿
    function loadDraft() {
      const draft = localStorage.getItem('mindfulEatingDraft');
      if (draft) {
        const draftData = JSON.parse(draft);
        const timeDiff = Date.now() - draftData.timestamp;
        
        // å¦‚æœè‰ç¨¿æ˜¯24å°æ—¶å†…çš„ï¼Œè¯¢é—®æ˜¯å¦æ¢å¤
        if (timeDiff < 24 * 60 * 60 * 1000) {
          if (confirm('å‘ç°æœªå®Œæˆçš„ç»ƒä¹ ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ')) {
            currentStep = draftData.currentStep;
            selectedFood = draftData.selectedFood;
            practiceData = draftData.practiceData;
            
            // æ¢å¤UIçŠ¶æ€
            if (currentStep > 0) {
              document.getElementById('foodSelection').classList.add('hidden');
              document.getElementById('practiceSteps').classList.remove('hidden');
              updateProgress();
              updateStepStates();
            }
          } else {
            localStorage.removeItem('mindfulEatingDraft');
          }
        }
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥è‰ç¨¿
    window.addEventListener('load', loadDraft);
  </script>
<!-- MindFit æ•°æ®ç®¡ç†å™¨ -->
<script src="js/data-manager.js"></script>

</body>
</html>
</body>
</html>
