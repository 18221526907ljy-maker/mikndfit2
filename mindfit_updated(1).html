<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>MindFit - 身心焦虑自助工具</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#0d9488",
            secondary: "#10B981",
            accent: "#6366f1",
            neutral: "#F3F4F6",
            dark: "#1F2937",
            light: "#F9FAFB",
          },
          fontFamily: {
            sans: ["PingFang SC", "Helvetica Neue", "Arial", "sans-serif"],
          },
        },
      },
    };
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      .transition-smooth {
        transition: all 0.3s ease;
      }
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .text-balance {
        text-wrap: balance;
      }
      .btn-primary {
        @apply w-full py-3 bg-primary text-white rounded-lg font-medium flex items-center justify-center;
      }
      .badge {
        @apply text-xs px-2 py-1 rounded-full;
      }
    }

    /* 美化测评滑杆 */
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: linear-gradient(to right, #0d9488, #10B981);
      outline: none;
      transition: background 0.3s;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #0d9488;
      cursor: pointer;
      transition: transform 0.2s;
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid #0d9488;
      cursor: pointer;
    }

    /* 结果进度条 */
    .result-gauge { 
      background:#f1f5f9; 
      border-radius:999px; 
      height:10px; 
      overflow:hidden; 
    }
    .result-gauge > .bar { 
      height:100%; 
      width:0; 
      background:linear-gradient(90deg,#0d9488,#10B981); 
      transition:width .6s ease; 
    }
    .result-gauge-label { 
      display:flex; 
      justify-content:space-between; 
      font-size:12px; 
      color:#475569; 
      margin:.5rem 0 .25rem; 
    }
    .badge-chip { 
      display:inline-block; 
      font-size:12px; 
      padding:2px 8px; 
      border-radius:999px; 
      background:#eef2ff; 
      color:#4f46e5; 
      margin-left:.5rem; 
    }
    .copy-btn { 
      font-size:12px; 
      color:#0d9488; 
      cursor:pointer; 
    }
    .copy-btn:hover { 
      text-decoration:underline; 
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .feature-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .feature-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    body {
      background: linear-gradient(135deg, #f0fdfa, #ecfdf5, #f0f9ff);
      min-height: 100vh;
    }

    .wellness-gradient {
      background: linear-gradient(135deg, #0d9488, #10B981, #06b6d4);
    }
  </style>
</head>

<body class="bg-gray-50 font-sans text-dark min-h-screen">
  <!-- 顶部导航栏 -->
  <header class="fixed top-0 left-0 right-0 glass-card shadow-sm z-50">
    <div class="flex items-center justify-between px-4 py-3">
      <div class="flex items-center">
        <button id="backBtn" class="p-2 text-gray-500 hover:text-primary transition-smooth">
          <i class="fa fa-arrow-left text-lg"></i>
        </button>
        <h1 id="pageTitle" class="text-xl font-medium ml-2">MindFit 身心管理</h1>
      </div>
      <div class="flex items-center space-x-4">
        <button class="p-2 text-gray-500 hover:text-primary transition-smooth" data-target="myRecordsPage">
          <i class="fa fa-list-alt text-lg"></i>
        </button>
        <button class="p-2 text-gray-500 hover:text-primary transition-smooth" data-target="myBadgesPage">
          <i class="fa fa-star-o text-lg"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- 提示 Toast -->
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 top-16 z-[60] hidden">
    <div class="bg-gray-900 text-white text-sm px-3 py-2 rounded-md shadow-lg"></div>
  </div>

  <!-- 主内容区 -->
  <main class="pt-16 pb-20 min-h-screen">
    <!-- 首页 -->
    <section id="homePage" class="page active">
      <div class="px-4 py-6">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-[clamp(1.5rem,3vw,1.8rem)] font-bold">身心焦虑自助工具</h2>
          <div class="flex items-center">
            <span class="text-sm text-gray-500 mr-2">我的进度</span>
            <div class="w-28 h-2 bg-gray-200 rounded-full overflow-hidden">
              <div id="progressBar" class="h-full bg-primary rounded-full" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- 功能卡片网格 -->
        <div class="grid grid-cols-2 gap-4 mb-8">
          <!-- BMI自评 -->
          <div class="feature-card glass-card rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="bmiPage">
            <div class="w-14 h-14 rounded-full bg-blue-100 flex items-center justify-center mb-3">
              <i class="ph ph-scales text-blue-500 text-2xl"></i>
            </div>
            <h3 class="text-base font-medium text-center">BMI功能自评</h3>
          </div>

          <!-- 轻测评 -->
          <div class="feature-card glass-card rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="assessmentPage">
            <div class="w-14 h-14 rounded-full bg-pink-100 flex items-center justify-center mb-3">
              <i class="ph ph-heartbeat text-pink-500 text-2xl"></i>
            </div>
            <h3 class="text-base font-medium text-center">身心轻测评</h3>
          </div>

          <!-- 自动思维记录 -->
          <div class="feature-card glass-card rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="thoughtRecordPage">
            <div class="w-14 h-14 rounded-full bg-blue-100 flex items-center justify-center mb-3">
              <i class="ph ph-pencil-simple text-blue-500 text-2xl"></i>
            </div>
            <h3 class="text-base font-medium text-center">自动思维记录</h3>
          </div>

          <!-- 情绪调节卡片 -->
          <div class="feature-card glass-card rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="emotionRegulationPage">
            <div class="w-14 h-14 rounded-full bg-green-100 flex items-center justify-center mb-3">
              <i class="ph ph-chat-centered-dots text-green-500 text-2xl"></i>
            </div>
            <h3 class="text-base font-medium text-center">情绪调节卡片</h3>
          </div>

          <!-- 行为实验指南 -->
          <div class="feature-card glass-card rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="behaviorExperimentPage">
            <div class="w-14 h-14 rounded-full bg-purple-100 flex items-center justify-center mb-3">
              <i class="ph ph-flask text-purple-500 text-2xl"></i>
            </div>
            <h3 class="text-base font-medium text-center">行为实验指南</h3>
          </div>

          <!-- 冥想/正念练习 -->
          <div class="feature-card glass-card rounded-xl p-5 card-shadow flex flex-col items-center justify-center transition-smooth hover:shadow-lg hover:-translate-y-1 cursor-pointer" data-target="mindfulnessPage">
            <div class="w-14 h-14 rounded-full bg-yellow-100 flex items-center justify-center mb-3">
              <i class="ph ph-headphones text-yellow-500 text-2xl"></i>
            </div>
            <h3 class="text-base font-medium text-center">冥想/正念练习</h3>
          </div>
        </div>

        <!-- 最近记录（动态） -->
        <div class="mb-6">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">最近记录</h3>
            <button class="text-primary text-sm flex items-center" data-target="myRecordsPage">
              查看全部 <i class="fa fa-angle-right ml-1"></i>
            </button>
          </div>
          <div id="recentList" class="space-y-3"></div>
        </div>

        <!-- 新解锁徽章（动态） -->
        <div id="badgeBanner" class="hidden bg-gradient-to-r from-primary to-accent rounded-xl p-5 text-white mb-6">
          <div class="flex items-start justify-between">
            <div>
              <h3 class="text-lg font-semibold mb-1">恭喜解锁新徽章！</h3>
              <p id="badgeBannerText" class="text-sm opacity-90 mb-3"></p>
              <button class="bg-white text-primary text-sm px-3 py-1.5 rounded-full font-medium" data-target="myBadgesPage">
                查看我的徽章
              </button>
            </div>
            <div class="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center">
              <i class="fa fa-star text-2xl"></i>
            </div>
          </div>
        </div>

        <!-- 为你推荐（动态） -->
        <div>
          <h3 class="text-lg font-semibold mb-4">身体中立理念</h3>
          <div id="recommendList" class="space-y-4">
            <div class="glass-card rounded-xl overflow-hidden card-shadow">
              <img src="https://picsum.photos/400/200?random=1" alt="身体中立入门" class="w-full h-40 object-cover">
              <div class="p-4">
                <h4 class="font-semibold mb-1">身体中立入门</h4>
                <p class="text-sm text-gray-500 mb-3 line-clamp-2">从功能与健康角度看待身体</p>
                <div class="flex items-center justify-between">
                  <span class="text-xs text-gray-400">2 分钟阅读</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- BMI功能自评页面 -->
    <section id="bmiPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">BMI功能自评</h2>
          <p class="text-gray-500 text-sm">以"功能健康±自我感受"双重视角呈现，避免机械"标准体重"评判</p>
        </div>

        <div class="glass-card rounded-xl p-5 card-shadow mb-6">
          <h3 class="text-lg font-semibold mb-4">基础信息</h3>
          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="block text-sm text-gray-600 mb-1">身高（cm）</label>
              <input id="heightInput" type="number" min="80" max="230" class="w-full p-3 border border-gray-200 rounded-lg" placeholder="例如 165" />
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">体重（kg）</label>
              <input id="weightInput" type="number" min="20" max="250" class="w-full p-3 border border-gray-200 rounded-lg" placeholder="例如 55" />
            </div>
          </div>
          <div class="mt-3">
            <label class="block text-sm text-gray-600 mb-1">此刻对身体的主观感受</label>
            <select id="bodyFeel" class="w-full p-3 border border-gray-200 rounded-lg">
              <option value="">请选择</option>
              <option value="舒适">舒适</option>
              <option value="紧绷">紧绷</option>
              <option value="疲惫">疲惫</option>
              <option value="不自信">不自信</option>
            </select>
          </div>
          <div class="mt-3 text-sm text-gray-600">
            <span id="bmiText" class="font-medium"></span>
          </div>
        </div>

        <!-- BMI参考表 -->
        <div class="glass-card rounded-xl p-5 card-shadow mb-6">
          <h3 class="text-lg font-semibold mb-4">BMI参考（中国人群）</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="border-b">
                  <th class="text-left py-2">BMI值范围</th>
                  <th class="text-left py-2">健康状态</th>
                  <th class="text-left py-2">建议</th>
                </tr>
              </thead>
              <tbody class="text-xs">
                <tr class="border-b">
                  <td class="py-2">&lt; 18.5</td>
                  <td class="py-2">偏瘦</td>
                  <td class="py-2">可能营养不足，建议适当增加优质蛋白和健康能量摄入</td>
                </tr>
                <tr class="border-b">
                  <td class="py-2">18.5-23.9</td>
                  <td class="py-2">正常</td>
                  <td class="py-2">身体质量处于理想区间，继续保持均衡饮食和适度运动</td>
                </tr>
                <tr class="border-b">
                  <td class="py-2">24.0-27.9</td>
                  <td class="py-2">超重</td>
                  <td class="py-2">建议结合饮食控制与运动逐步恢复到正常范围</td>
                </tr>
                <tr>
                  <td class="py-2">≥ 28.0</td>
                  <td class="py-2">肥胖</td>
                  <td class="py-2">需重点关注，建议在专业指导下制定体重管理方案</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="glass-card rounded-xl p-5 card-shadow">
          <div class="bg-blue-50 border border-blue-200 text-blue-800 text-sm rounded px-3 py-2">
            💡 在MindFit基础自评中，我们结合主观身体感受，以"功能健康"而非单一体重目标来认识身体状态。
          </div>
        </div>
      </div>
    </section>

    <!-- 身心轻测评 -->
    <section id="assessmentPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">身心轻测评</h2>
          <p class="text-gray-500 text-sm">9 题 5 级量表，生成个性化建议与今日小任务</p>
        </div>

        <!-- 9题量表 -->
        <div class="glass-card rounded-xl p-5 card-shadow mb-6">
          <h3 class="text-lg font-semibold mb-4">9 题量表（1=从不，5=总是）</h3>
          <div id="qList" class="space-y-3"></div>
        </div>

        <!-- 结果 -->
        <div class="glass-card rounded-xl p-5 card-shadow mb-6">
          <button id="btnAssess" class="btn-primary"><i class="fa fa-check mr-2"></i>提交并生成建议</button>
          <div id="lightResult" class="hidden mt-4 border border-gray-100 rounded-lg p-4 bg-gray-50">
            <div id="lightSummary" class="mb-3 text-sm font-medium"></div>
            <p class="text-sm text-gray-600 mb-2">建议 & 今日小任务：</p>
            <ul id="lightAdvice" class="list-disc pl-5 space-y-1 text-sm"></ul>
          </div>
        </div>

        <!-- 专业测评入口 -->
        <div class="glass-card rounded-xl p-5 card-shadow">
          <h3 class="text-lg font-semibold mb-3">专业测评</h3>
          <p class="text-sm text-gray-600 mb-3">30题专业量表，基于国际心理测评标准，提供更详细的身心状态分析</p>
          <button id="btnProAssess" class="w-full py-3 bg-secondary text-white rounded-lg font-medium">
            <i class="fa fa-clipboard-list mr-2"></i>开始专业测评
          </button>
          <div id="proResult" class="hidden mt-4 border border-gray-100 rounded-lg p-4 bg-gray-50">
            <div id="proSummary" class="mb-3 text-sm font-medium"></div>
            <p class="text-sm text-gray-600 mb-2">专属小计划：</p>
            <ul id="proPlan" class="list-disc pl-5 space-y-1 text-sm"></ul>
          </div>
        </div>
      </div>
    </section>

    <!-- 自动思维记录 -->
    <section id="thoughtRecordPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">自动思维记录</h2>
          <p class="text-gray-500 text-sm">记录并分析你的想法与情绪反应（聚焦身材/自我评价/社交媒体等）</p>
        </div>

        <!-- 捕捉 -->
        <div class="glass-card rounded-xl p-5 card-shadow mb-6">
          <h3 class="text-lg font-semibold mb-4">捕捉</h3>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-2">情境</label>
            <select id="trContext" class="w-full p-3 border border-gray-200 rounded-lg">
              <option value="">请选择或输入情境</option>
              <option>外貌被评价</option>
              <option>社交媒体对比</option>
              <option>体重波动</option>
              <option>穿衣不自信</option>
              <option>饮食控制失控</option>
              <option>自我怀疑</option>
              <option>家庭沟通</option>
              <option>其他（请在下方输入）</option>
            </select>
            <input id="trContextCustom" type="text" placeholder="如选择'其他'，请在此输入具体情境" class="w-full mt-2 p-3 border border-gray-200 rounded-lg" />
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-2">当时的想法</label>
            <textarea id="trThought" placeholder="请描述你当时的想法..." rows="4" class="w-full p-3 border border-gray-200 rounded-lg"></textarea>
          </div>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-2">证据（支持/反对）</label>
            <textarea id="trEvidence" placeholder="有没有证据支持或反驳这个想法？" rows="3" class="w-full p-3 border border-gray-200 rounded-lg"></textarea>
          </div>

          <div class="">
            <div class="flex items-center justify-between mb-2">
              <label class="block text-sm font-medium text-gray-700">情绪强度</label>
              <span id="emotionScore" class="text-primary font-semibold">5</span>
            </div>
            <input id="trEmotion" type="range" min="1" max="10" value="5" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-primary" oninput="document.getElementById('emotionScore').textContent = this.value" />
            <div class="flex justify-between text-xs text-gray-500 mt-1">
              <span>轻微</span><span>中等</span><span>强烈</span>
            </div>
          </div>
        </div>

        <!-- 操作 -->
        <div class="glass-card rounded-xl p-5 card-shadow mb-6 space-y-3">
          <button id="btnSaveTR" class="btn-primary"><i class="fa fa-save mr-2"></i>保存记录</button>
          <div class="grid grid-cols-2 gap-3">
            <button id="btnExportCSV" class="py-2 border border-primary text-primary rounded-lg font-medium text-sm"><i class="fa fa-table mr-1"></i>导出 CSV</button>
            <button id="btnPrint" class="py-2 border border-gray-300 text-gray-700 rounded-lg font-medium text-sm"><i class="fa fa-file-pdf-o mr-1"></i>打印为 PDF</button>
          </div>
        </div>

        <!-- 最近记录预览 -->
        <div class="glass-card rounded-xl p-5 card-shadow">
          <h3 class="text-lg font-semibold mb-4">最近一次记录</h3>
          <div id="trPreview" class="border border-gray-100 rounded-lg p-4 bg-gray-50 text-sm text-gray-700">
            暂无记录，保存后会显示预览。
          </div>
        </div>
      </div>
    </section>

    <!-- 情绪调节卡片 -->
    <section id="emotionRegulationPage" class="page hidden">
      <div class="px-4 py-6">
        <div class="mb-6">
          <h2 class="text-xl font-bold mb-2">情绪调节卡片</h2>
          <p class="text-gray-500 text-sm">通过简单练习，缓解焦虑、重获平衡</p>
        </div>

        <!-- 轮播容器 -->
        <div class="relative mb-8">
          <div class="carousel-container overflow-x-auto scrollbar-hide pb-4">
            <div class="carousel-track flex space-x-4 min-w-max px-1">
              <!-- 卡片 1：深呼吸 -->
              <div class="emotion-card glass-card rounded-xl overflow-hidden card-shadow w-72 flex-shrink-0" data-card="deepBreath">
                <div class="h-36 bg-blue-50 relative">
                  <img src="https://picsum.photos/300/200?random=13" alt="深呼吸练习" class="w-full h-full object-cover opacity-70" />
                  <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent flex items-end">
                    <h3 class="text-white text-lg font-semibold p-4">深呼吸练习</h3>
                  </div>
                </div>
                <div class="p-4">
                  <p class="text-sm text-gray-600 mb-4">4-2-6 呼吸：吸气 4 秒 - 停 2 秒 - 呼气 6 秒，重复 5–10 次。</p>
                  <button class="complete-btn w-full py-2 border border-primary text-primary rounded-lg font-medium text-sm transition-smooth hover:bg-primary hover:text-white">
                    标记完成
                  </button>
                </div>
              </div>

              <!-- 卡片 2：五感觉察 -->
              <div class="emotion-card glass-card rounded-xl overflow-hidden card-shadow w-72 flex-shrink-0 opacity-90" data-card="fiveSenses">
                <div class="h-36 bg-green-50 relative">
                  <img src="https://picsum.photos/300/200?random=14" alt="五感觉察练习" class="w-full h-full object-cover opacity-70" />
                  <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent flex items-end">
                    <h3 class="text-white text-lg font-semibold p-4">五感觉察</h3>
                  </div>
                  <div class="absolute top-3 right-3 hidden done-sticker bg-green-500 text-white text-xs px-2 py-1 rounded-full">已完成</div>
                </div>
                <div class="p-4">
                  <p class="text-sm text-gray-600 mb-4">说出你看到/摸到/听到/闻到/尝到的 5-4-3-2-1 样东西。</p>
                  <button class="complete-btn w-full py-2 border border-primary text-primary rounded-lg font-medium text-sm transition-smooth hover:bg-primary hover:text-white">
                    标记完成
                  </button>
                </div>
              </div>

              <!-- 卡片 3：正念饮食 