<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç¤¾äº¤åª’ä½“å½±å“è¿½è¸ªå™¨ - MindFit</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" />
  
  <style>
    .platform-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .platform-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .platform-card.selected {
      border-color: #4A6157;
      background: #f0f7f4;
    }
    
    .content-type-chip {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .content-type-chip:hover {
      transform: scale(1.05);
    }
    
    .content-type-chip.selected {
      background: #4A6157;
      color: white;
    }
    
    .toast {
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(0, 0, 0, 0.85);
      color: white;
      padding: 12px 24px;
      border-radius: 25px;
      font-size: 14px;
      z-index: 1000;
      opacity: 0;
      transition: all 0.4s ease;
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    .tab-btn {
      transition: all 0.3s ease;
    }
    
    .tab-btn.active {
      background: #4A6157;
      color: white;
    }

    .stat-card {
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#4A6157",
            mint: "#8FD9A8",
            accent: "#2E2E2E"
          }
        }
      }
    };
  </script>
</head>

<body class="bg-gray-50">
  
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <nav class="bg-white shadow-sm sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <a href="cbt_tools.html" class="flex items-center text-primary hover:text-mint transition-all duration-300 group">
            <span class="mr-2 transition-transform group-hover:-translate-x-1">â†</span>
            <span class="font-medium">è¿”å›å·¥å…·ç®±</span>
          </a>
        </div>
        <div class="flex items-center space-x-2">
          <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center">
            <i class="fa fa-mobile text-white text-sm"></i>
          </div>
          <span class="text-lg font-bold text-primary">ç¤¾äº¤åª’ä½“è¿½è¸ª</span>
        </div>
      </div>
    </div>
  </nav>

  <!-- Toast æç¤º -->
  <div id="toast" class="toast">
    <div class="flex items-center">
      <span class="mr-2">âœ“</span>
      <span id="toastMessage"></span>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-4 py-8">
    
    <!-- æ ‡ç­¾åˆ‡æ¢ -->
    <div class="bg-white rounded-2xl p-2 shadow-sm mb-8 flex gap-2">
      <button id="recordTab" class="tab-btn active flex-1 px-6 py-3 rounded-lg font-medium" onclick="switchTab('record')">
        <i class="fa fa-plus-circle mr-2"></i>
        æ–°å¢è®°å½•
      </button>
      <button id="statsTab" class="tab-btn flex-1 px-6 py-3 rounded-lg font-medium bg-gray-100 text-gray-600" onclick="switchTab('stats')">
        <i class="fa fa-bar-chart mr-2"></i>
        ç»Ÿè®¡åˆ†æ
      </button>
      <button id="historyTab" class="tab-btn flex-1 px-6 py-3 rounded-lg font-medium bg-gray-100 text-gray-600" onclick="switchTab('history')">
        <i class="fa fa-history mr-2"></i>
        å†å²è®°å½•
      </button>
    </div>

    <!-- è®°å½•è¡¨å• -->
    <div id="recordSection" class="space-y-6">
      
      <div class="bg-white rounded-2xl p-6 md:p-8 shadow-sm">
        <h2 class="text-2xl font-bold text-primary mb-2">è®°å½•è§¦å‘æ—¶åˆ»</h2>
        <p class="text-sm text-gray-600 mb-6">
          ğŸ’¡ å½“ä½ åˆ·ç¤¾äº¤åª’ä½“åæ„Ÿåˆ°ç„¦è™‘ã€è‡ªå‘æˆ–æ²®ä¸§æ—¶ï¼Œç«‹å³è®°å½•ä¸‹æ¥
        </p>

        <div class="space-y-6">
          
          <!-- å¹³å°é€‰æ‹© -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-3">
              <i class="fa fa-mobile text-primary mr-2"></i>
              åœ¨å“ªä¸ªå¹³å°ä¸Šçœ‹åˆ°çš„ï¼Ÿ
            </label>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
              <div class="platform-card border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectPlatform(this, 'instagram')">
                <div class="text-3xl mb-2">ğŸ“·</div>
                <div class="text-sm font-medium">Instagram</div>
              </div>
              <div class="platform-card border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectPlatform(this, 'xiaohongshu')">
                <div class="text-3xl mb-2">ğŸ“•</div>
                <div class="text-sm font-medium">å°çº¢ä¹¦</div>
              </div>
              <div class="platform-card border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectPlatform(this, 'douyin')">
                <div class="text-3xl mb-2">ğŸµ</div>
                <div class="text-sm font-medium">æŠ–éŸ³</div>
              </div>
              <div class="platform-card border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectPlatform(this, 'weibo')">
                <div class="text-3xl mb-2">ğŸ”¥</div>
                <div class="text-sm font-medium">å¾®åš</div>
              </div>
              <div class="platform-card border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectPlatform(this, 'bilibili')">
                <div class="text-3xl mb-2">ğŸ“º</div>
                <div class="text-sm font-medium">Bç«™</div>
              </div>
              <div class="platform-card border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectPlatform(this, 'wechat')">
                <div class="text-3xl mb-2">ğŸ’¬</div>
                <div class="text-sm font-medium">å¾®ä¿¡æœ‹å‹åœˆ</div>
              </div>
              <div class="platform-card border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectPlatform(this, 'facebook')">
                <div class="text-3xl mb-2">ğŸ‘</div>
                <div class="text-sm font-medium">Facebook</div>
              </div>
              <div class="platform-card border-2 border-gray-200 rounded-lg p-4 text-center" onclick="selectPlatform(this, 'other')">
                <div class="text-3xl mb-2">ğŸ“±</div>
                <div class="text-sm font-medium">å…¶ä»–</div>
              </div>
            </div>
          </div>

          <!-- å†…å®¹ç±»å‹ -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-3">
              <i class="fa fa-image text-primary mr-2"></i>
              çœ‹åˆ°çš„æ˜¯ä»€ä¹ˆç±»å‹çš„å†…å®¹ï¼Ÿ(å¯å¤šé€‰)
            </label>
            <div class="flex flex-wrap gap-2">
              <span class="content-type-chip px-4 py-2 bg-gray-100 rounded-full text-sm" onclick="toggleContentType(this, 'å¥èº«åšä¸»')">ğŸ’ª å¥èº«åšä¸»</span>
              <span class="content-type-chip px-4 py-2 bg-gray-100 rounded-full text-sm" onclick="toggleContentType(this, 'æ¨¡ç‰¹/ç½‘çº¢')">ğŸ‘— æ¨¡ç‰¹/ç½‘çº¢</span>
              <span class="content-type-chip px-4 py-2 bg-gray-100 rounded-full text-sm" onclick="toggleContentType(this, 'å‡è‚¥æˆåŠŸæ¡ˆä¾‹')">ğŸ“‰ å‡è‚¥æˆåŠŸæ¡ˆä¾‹</span>
              <span class="content-type-chip px-4 py-2 bg-gray-100 rounded-full text-sm" onclick="toggleContentType(this, 'å®Œç¾èº«æå±•ç¤º')">âœ¨ å®Œç¾èº«æå±•ç¤º</span>
              <span class="content-type-chip px-4 py-2 bg-gray-100 rounded-full text-sm" onclick="toggleContentType(this, 'é¥®é£Ÿæ‰“å¡')">ğŸ¥— é¥®é£Ÿæ‰“å¡</span>
              <span class="content-type-chip px-4 py-2 bg-gray-100 rounded-full text-sm" onclick="toggleContentType(this, 'è¿åŠ¨æ‰“å¡')">ğŸƒ è¿åŠ¨æ‰“å¡</span>
              <span class="content-type-chip px-4 py-2 bg-gray-100 rounded-full text-sm" onclick="toggleContentType(this, 'ç¾å¦†/ç©¿æ­')">ğŸ’„ ç¾å¦†/ç©¿æ­</span>
              <span class="content-type-chip px-4 py-2 bg-gray-100 rounded-full text-sm" onclick="toggleContentType(this, 'æ˜æ˜Ÿ/è‰ºäºº')">â­ æ˜æ˜Ÿ/è‰ºäºº</span>
              <span class="content-type-chip px-4 py-2 bg-gray-100 rounded-full text-sm" onclick="toggleContentType(this, 'æœ‹å‹/ç†Ÿäºº')">ğŸ‘« æœ‹å‹/ç†Ÿäºº</span>
              <span class="content-type-chip px-4 py-2 bg-gray-100 rounded-full text-sm" onclick="toggleContentType(this, 'å…¶ä»–')">ğŸ“Œ å…¶ä»–</span>
            </div>
          </div>

          <!-- å…·ä½“æè¿° -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fa fa-file-text text-primary mr-2"></i>
              å…·ä½“æ˜¯ä»€ä¹ˆå†…å®¹ï¼Ÿ(å¯é€‰)
            </label>
            <textarea 
              id="contentDescription" 
              rows="2" 
              class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:border-transparent"
              placeholder="ä¾‹å¦‚: ä¸€ä¸ªåšä¸»åˆ†äº«å¥¹çš„30å¤©å‡è‚¥æˆåŠŸç…§ç‰‡..."
            ></textarea>
          </div>

          <!-- è‡ªåŠ¨åŒ–æ€ç»´ -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fa fa-comment text-primary mr-2"></i>
              çœ‹å®Œåè„‘æµ·ä¸­å‡ºç°çš„æƒ³æ³•
            </label>
            <textarea 
              id="automaticThought" 
              rows="3" 
              class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-primary focus:border-transparent"
              placeholder='ä¾‹å¦‚: "æˆ‘æ°¸è¿œåšä¸åˆ°è¿™æ ·"ã€"æˆ‘å¤ªèƒ–äº†"ã€"ä¸ºä»€ä¹ˆæˆ‘ä¸èƒ½è¿™ä¹ˆç˜¦"ã€"æˆ‘çœŸå¤±è´¥"...'
            ></textarea>
          </div>

          <!-- æƒ…ç»ªè¯„åˆ† -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              <i class="fa fa-heart text-primary mr-2"></i>
              è§¦å‘çš„ä¸»è¦æƒ…ç»ªå’Œå¼ºåº¦
            </label>
            
            <div class="space-y-4">
              <div>
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm">ğŸ˜° ç„¦è™‘/ä¸å®‰</span>
                  <span class="text-sm font-bold text-primary" id="anxietyValue">0</span>
                </div>
                <input type="range" id="anxiety" min="0" max="10" value="0" class="w-full" oninput="updateEmotionValue('anxiety')">
              </div>
              
              <div>
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm">ğŸ˜ è‡ªå‘/ç¾æ„§</span>
                  <span class="text-sm font-bold text-primary" id="shameValue">0</span>
                </div>
                <input type="range" id="shame" min="0" max="10" value="0" class="w-full" oninput="updateEmotionValue('shame')">
              </div>
              
              <div>
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm">ğŸ˜  å«‰å¦’/ä¸æ»¡</span>
                  <span class="text-sm font-bold text-primary" id="envyValue">0</span>
                </div>
                <input type="range" id="envy" min="0" max="10" value="0" class="w-full" oninput="updateEmotionValue('envy')">
              </div>
              
              <div>
                <div class="flex items-center justify-between mb-2">
                  <span class="text-sm">ğŸ˜¢ æ‚²ä¼¤/ç»æœ›</span>
                  <span class="text-sm font-bold text-primary" id="sadnessValue">0</span>
                </div>
                <input type="range" id="sadness" min="0" max="10" value="0" class="w-full" oninput="updateEmotionValue('sadness')">
              </div>
            </div>
          </div>

          <!-- ä¿å­˜æŒ‰é’® -->
          <div class="pt-4">
            <button onclick="saveRecord()" class="w-full bg-primary hover:bg-mint text-white py-4 rounded-lg font-medium transition-colors">
              <i class="fa fa-save mr-2"></i>
              ä¿å­˜è®°å½•
            </button>
          </div>

        </div>
      </div>

      <!-- å°è´´å£« -->
      <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-6">
        <h3 class="font-semibold text-blue-900 mb-3">ğŸ’¡ ä½¿ç”¨å»ºè®®</h3>
        <ul class="space-y-2 text-sm text-blue-800">
          <li>â€¢ <strong>ç«‹å³è®°å½•</strong>: æ„Ÿåˆ°ä¸é€‚çš„æ—¶å€™é©¬ä¸Šè®°å½•ï¼Œä¸è¦ç­‰å¾…</li>
          <li>â€¢ <strong>è¯šå®é¢å¯¹</strong>: è®°å½•çœŸå®çš„æƒ³æ³•å’Œæ„Ÿå—ï¼Œä¸éœ€è¦ç¾åŒ–</li>
          <li>â€¢ <strong>å®šæœŸå›é¡¾</strong>: ä¸€å‘¨åæŸ¥çœ‹ç»Ÿè®¡ï¼Œäº†è§£å“ªäº›å†…å®¹æœ€å®¹æ˜“è§¦å‘ä½ </li>
          <li>â€¢ <strong>é‡‡å–è¡ŒåŠ¨</strong>: æ ¹æ®åˆ†æç»“æœï¼Œè€ƒè™‘å–å…³æˆ–å±è”½ç‰¹å®šè´¦å·</li>
        </ul>
      </div>
    </div>

    <!-- ç»Ÿè®¡åˆ†æé¡µé¢ -->
    <div id="statsSection" class="hidden space-y-6">
      
      <!-- æ€»è§ˆå¡ç‰‡ -->
      <div class="grid md:grid-cols-4 gap-4">
        <div class="stat-card bg-white rounded-xl p-6 shadow-sm">
          <div class="text-sm text-gray-600 mb-2">æ€»è®°å½•æ¬¡æ•°</div>
          <div class="text-3xl font-bold text-primary" id="totalRecords">0</div>
        </div>
        
        <div class="stat-card bg-white rounded-xl p-6 shadow-sm">
          <div class="text-sm text-gray-600 mb-2">æœ¬å‘¨è§¦å‘æ¬¡æ•°</div>
          <div class="text-3xl font-bold text-orange-600" id="weekRecords">0</div>
        </div>
        
        <div class="stat-card bg-white rounded-xl p-6 shadow-sm">
          <div class="text-sm text-gray-600 mb-2">å¹³å‡æƒ…ç»ªå¼ºåº¦</div>
          <div class="text-3xl font-bold text-red-600" id="avgIntensity">0</div>
        </div>
        
        <div class="stat-card bg-white rounded-xl p-6 shadow-sm">
          <div class="text-sm text-gray-600 mb-2">æœ€å¸¸è§¦å‘å¹³å°</div>
          <div class="text-lg font-bold text-purple-600" id="topPlatform">-</div>
        </div>
      </div>

      <!-- æœ€æ˜“è§¦å‘çš„å†…å®¹ç±»å‹ -->
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <h3 class="text-xl font-bold text-primary mb-4">
          <i class="fa fa-warning text-orange-500 mr-2"></i>
          æœ€å®¹æ˜“è§¦å‘ç„¦è™‘çš„å†…å®¹
        </h3>
        <div id="topContentTypes" class="space-y-3">
          <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <!-- å¹³å°åˆ†å¸ƒ -->
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <h3 class="text-xl font-bold text-primary mb-4">
          <i class="fa fa-pie-chart mr-2"></i>
          å„å¹³å°è§¦å‘æ¬¡æ•°
        </h3>
        <div id="platformStats" class="space-y-3">
          <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

      <!-- ä¸ªæ€§åŒ–å»ºè®® -->
      <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-6 border-2 border-purple-200">
        <h3 class="text-xl font-bold text-purple-900 mb-4">
          <i class="fa fa-lightbulb-o mr-2"></i>
          ä¸ªæ€§åŒ–å»ºè®®
        </h3>
        <div id="recommendations" class="space-y-3 text-sm text-purple-800">
          <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>
      </div>

    </div>

    <!-- å†å²è®°å½•é¡µé¢ -->
    <div id="historySection" class="hidden">
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-bold text-primary">å†å²è®°å½•</h3>
          <button onclick="clearAllRecords()" class="text-sm text-red-600 hover:text-red-700">
            <i class="fa fa-trash mr-1"></i>
            æ¸…ç©ºæ‰€æœ‰è®°å½•
          </button>
        </div>
        
        <div id="historyList" class="space-y-4">
          <!-- åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div id="emptyHistory" class="hidden text-center py-12">
          <div class="text-6xl mb-4">ğŸ“±</div>
          <h3 class="text-lg font-semibold text-gray-700 mb-2">è¿˜æ²¡æœ‰è®°å½•</h3>
          <p class="text-gray-500 mb-6">å½“ä½ åˆ·ç¤¾äº¤åª’ä½“æ„Ÿåˆ°ä¸é€‚æ—¶ï¼Œè®°å½•ä¸‹æ¥</p>
          <button onclick="switchTab('record')" class="bg-primary text-white px-6 py-3 rounded-lg font-medium hover:bg-mint transition-colors">
            å¼€å§‹è®°å½•
          </button>
        </div>
      </div>
    </div>

  </main>

  <script>
    // ============================================
    // å…¨å±€å˜é‡
    // ============================================
    
    let selectedPlatform = null;
    let selectedContentTypes = [];

    // ============================================
    // æ ‡ç­¾åˆ‡æ¢
    // ============================================
    
    function switchTab(tab) {
      // æ›´æ–°æŒ‰é’®çŠ¶æ€
      document.getElementById('recordTab').classList.remove('active');
      document.getElementById('recordTab').classList.add('bg-gray-100', 'text-gray-600');
      document.getElementById('statsTab').classList.remove('active');
      document.getElementById('statsTab').classList.add('bg-gray-100', 'text-gray-600');
      document.getElementById('historyTab').classList.remove('active');
      document.getElementById('historyTab').classList.add('bg-gray-100', 'text-gray-600');
      
      document.getElementById(`${tab}Tab`).classList.add('active');
      document.getElementById(`${tab}Tab`).classList.remove('bg-gray-100', 'text-gray-600');
      
      // æ˜¾ç¤ºå¯¹åº”å†…å®¹
      document.getElementById('recordSection').classList.add('hidden');
      document.getElementById('statsSection').classList.add('hidden');
      document.getElementById('historySection').classList.add('hidden');
      
      document.getElementById(`${tab}Section`).classList.remove('hidden');
      
      // å¦‚æœåˆ‡æ¢åˆ°ç»Ÿè®¡æˆ–å†å²ï¼ŒåŠ è½½æ•°æ®
      if (tab === 'stats') {
        loadStats();
      } else if (tab === 'history') {
        loadHistory();
      }
    }

    // ============================================
    // å¹³å°é€‰æ‹©
    // ============================================
    
    function selectPlatform(card, platform) {
      // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
      document.querySelectorAll('.platform-card').forEach(c => {
        c.classList.remove('selected');
      });
      
      // é€‰ä¸­å½“å‰å¹³å°
      card.classList.add('selected');
      selectedPlatform = platform;
    }

    // ============================================
    // å†…å®¹ç±»å‹é€‰æ‹©
    // ============================================
    
    function toggleContentType(chip, type) {
      chip.classList.toggle('selected');
      
      const index = selectedContentTypes.indexOf(type);
      if (index > -1) {
        selectedContentTypes.splice(index, 1);
      } else {
        selectedContentTypes.push(type);
      }
    }

    // ============================================
    // æƒ…ç»ªå€¼æ›´æ–°
    // ============================================
    
    function updateEmotionValue(emotion) {
      const value = document.getElementById(emotion).value;
      document.getElementById(`${emotion}Value`).textContent = value;
    }

    // ============================================
    // ä¿å­˜è®°å½•
    // ============================================
    
    function saveRecord() {
      // éªŒè¯å¿…å¡«é¡¹
      if (!selectedPlatform) {
        showToast('è¯·é€‰æ‹©å¹³å°');
        return;
      }
      
      if (selectedContentTypes.length === 0) {
        showToast('è¯·é€‰æ‹©è‡³å°‘ä¸€ç§å†…å®¹ç±»å‹');
        return;
      }
      
      const automaticThought = document.getElementById('automaticThought').value.trim();
      if (!automaticThought) {
        showToast('è¯·å†™ä¸‹è§¦å‘çš„æƒ³æ³•');
        return;
      }
      
      // æ”¶é›†æƒ…ç»ªæ•°æ®
      const emotions = {
        anxiety: parseInt(document.getElementById('anxiety').value),
        shame: parseInt(document.getElementById('shame').value),
        envy: parseInt(document.getElementById('envy').value),
        sadness: parseInt(document.getElementById('sadness').value)
      };
      
      // è®¡ç®—å¹³å‡æƒ…ç»ªå¼ºåº¦
      const avgEmotion = (emotions.anxiety + emotions.shame + emotions.envy + emotions.sadness) / 4;
      
      // åˆ›å»ºè®°å½•
      const record = {
        id: Date.now(),
        date: new Date().toISOString(),
        platform: selectedPlatform,
        contentTypes: selectedContentTypes,
        contentDescription: document.getElementById('contentDescription').value,
        automaticThought: automaticThought,
        emotions: emotions,
        avgEmotion: avgEmotion.toFixed(1)
      };
      
      // ä¿å­˜åˆ° localStorage
      try {
        const records = JSON.parse(localStorage.getItem('socialMediaRecords') || '[]');
        records.push(record);
        localStorage.setItem('socialMediaRecords', JSON.stringify(records));
        
        showToast('è®°å½•å·²ä¿å­˜ï¼');
        
        // é‡ç½®è¡¨å•
        setTimeout(() => {
          resetForm();
          switchTab('stats');
        }, 1500);
        
      } catch (error) {
        console.error('ä¿å­˜å¤±è´¥:', error);
        showToast('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }

    // ============================================
    // é‡ç½®è¡¨å•
    // ============================================
    
    function resetForm() {
      selectedPlatform = null;
      selectedContentTypes = [];
      
      document.querySelectorAll('.platform-card').forEach(c => {
        c.classList.remove('selected');
      });
      
      document.querySelectorAll('.content-type-chip').forEach(c => {
        c.classList.remove('selected');
      });
      
      document.getElementById('contentDescription').value = '';
      document.getElementById('automaticThought').value = '';
      
      document.getElementById('anxiety').value = 0;
      document.getElementById('shame').value = 0;
      document.getElementById('envy').value = 0;
      document.getElementById('sadness').value = 0;
      
      updateEmotionValue('anxiety');
      updateEmotionValue('shame');
      updateEmotionValue('envy');
      updateEmotionValue('sadness');
    }

    // ============================================
    // åŠ è½½ç»Ÿè®¡æ•°æ®
    // ============================================
    
    function loadStats() {
      const records = JSON.parse(localStorage.getItem('socialMediaRecords') || '[]');
      
      if (records.length === 0) {
        showEmptyStats();
        return;
      }
      
      // æ€»è®°å½•æ¬¡æ•°
      document.getElementById('totalRecords').textContent = records.length;
      
      // æœ¬å‘¨è®°å½•æ¬¡æ•°
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      const weekRecords = records.filter(r => new Date(r.date) > weekAgo);
      document.getElementById('weekRecords').textContent = weekRecords.length;
      
      // å¹³å‡æƒ…ç»ªå¼ºåº¦
      const avgIntensity = records.reduce((sum, r) => sum + parseFloat(r.avgEmotion), 0) / records.length;
      document.getElementById('avgIntensity').textContent = avgIntensity.toFixed(1);
      
      // æœ€å¸¸è§¦å‘å¹³å°
      const platformCounts = {};
      records.forEach(r => {
        platformCounts[r.platform] = (platformCounts[r.platform] || 0) + 1;
      });
      const topPlatform = Object.keys(platformCounts).reduce((a, b) => 
        platformCounts[a] > platformCounts[b] ? a : b
      );
      document.getElementById('topPlatform').textContent = getPlatformName(topPlatform);
      
      // æœ€æ˜“è§¦å‘çš„å†…å®¹ç±»å‹
      renderTopContentTypes(records);
      
      // å¹³å°åˆ†å¸ƒ
      renderPlatformStats(platformCounts, records.length);
      
      // ä¸ªæ€§åŒ–å»ºè®®
      generateRecommendations(records);
    }

    function showEmptyStats() {
      document.getElementById('totalRecords').textContent = '0';
      document.getElementById('weekRecords').textContent = '0';
      document.getElementById('avgIntensity').textContent = '0';
      document.getElementById('topPlatform').textContent = '-';
      document.getElementById('topContentTypes').innerHTML = '<p class="text-gray-500">æš‚æ— æ•°æ®</p>';
      document.getElementById('platformStats').innerHTML = '<p class="text-gray-500">æš‚æ— æ•°æ®</p>';
      document.getElementById('recommendations').innerHTML = '<p>å¼€å§‹è®°å½•åï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºä¸ªæ€§åŒ–å»ºè®®</p>';
    }

    function renderTopContentTypes(records) {
      const contentCounts = {};
      const contentEmotions = {};
      
      records.forEach(r => {
        r.contentTypes.forEach(type => {
          contentCounts[type] = (contentCounts[type] || 0) + 1;
          contentEmotions[type] = (contentEmotions[type] || 0) + parseFloat(r.avgEmotion);
        });
      });
      
      // è®¡ç®—æ¯ç§å†…å®¹çš„å¹³å‡æƒ…ç»ªå¼ºåº¦
      Object.keys(contentEmotions).forEach(type => {
        contentEmotions[type] = contentEmotions[type] / contentCounts[type];
      });
      
      // æŒ‰å¹³å‡æƒ…ç»ªå¼ºåº¦æ’åº
      const sorted = Object.keys(contentEmotions).sort((a, b) => 
        contentEmotions[b] - contentEmotions[a]
      );
      
      const container = document.getElementById('topContentTypes');
      container.innerHTML = sorted.slice(0, 5).map(type => `
        <div class="flex items-center justify-between p-4 bg-orange-50 rounded-lg">
          <div class="flex items-center">
            <div class="w-2 h-2 bg-orange-500 rounded-full mr-3"></div>
            <span class="font-medium text-gray-800">${type}</span>
          </div>
          <div class="text-right">
            <div class="text-sm text-gray-600">${contentCounts[type]} æ¬¡è§¦å‘</div>
            <div class="text-sm font-bold text-orange-600">å¹³å‡å¼ºåº¦: ${contentEmotions[type].toFixed(1)}</div>
          </div>
        </div>
      `).join('');
    }

    function renderPlatformStats(platformCounts, total) {
      const container = document.getElementById('platformStats');
      
      const platformNames = {
        'instagram': 'Instagram',
        'xiaohongshu': 'å°çº¢ä¹¦',
        'douyin': 'æŠ–éŸ³',
        'weibo': 'å¾®åš',
        'bilibili': 'Bç«™',
        'wechat': 'å¾®ä¿¡æœ‹å‹åœˆ',
        'facebook': 'Facebook',
        'other': 'å…¶ä»–'
      };
      
      container.innerHTML = Object.keys(platformCounts)
        .sort((a, b) => platformCounts[b] - platformCounts[a])
        .map(platform => {
          const count = platformCounts[platform];
          const percentage = (count / total * 100).toFixed(1);
          
          return `
            <div class="space-y-2">
              <div class="flex items-center justify-between">
                <span class="text-sm font-medium">${platformNames[platform] || platform}</span>
                <span class="text-sm text-gray-600">${count} æ¬¡ (${percentage}%)</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-primary rounded-full h-2" style="width: ${percentage}%"></div>
              </div>
            </div>
          `;
        }).join('');
    }

    function generateRecommendations(records) {
      const container = document.getElementById('recommendations');
      const recommendations = [];
      
      // åŸºäºè®°å½•é¢‘ç‡çš„å»ºè®®
      if (records.length > 10) {
        recommendations.push('ğŸ“Š ä½ å·²ç»è®°å½•äº†å¾ˆå¤šæ¬¡è§¦å‘äº‹ä»¶ï¼Œè€ƒè™‘å‡å°‘åˆ·ç¤¾äº¤åª’ä½“çš„æ—¶é—´');
      }
      
      // åŸºäºæœ¬å‘¨é¢‘ç‡çš„å»ºè®®
      const weekAgo = new Date();
      weekAgo.setDate(weekAgo.getDate() - 7);
      const weekRecords = records.filter(r => new Date(r.date) > weekAgo);
      
      if (weekRecords.length > 5) {
        recommendations.push('âš ï¸ æœ¬å‘¨è§¦å‘é¢‘ç‡è¾ƒé«˜ï¼Œå»ºè®®æš‚æ—¶è¿œç¦»ç¤¾äº¤åª’ä½“');
      }
      
      // åŸºäºå¹³å°çš„å»ºè®®
      const platformCounts = {};
      records.forEach(r => {
        platformCounts[r.platform] = (platformCounts[r.platform] || 0) + 1;
      });
      
      const topPlatforms = Object.keys(platformCounts)
        .sort((a, b) => platformCounts[b] - platformCounts[a])
        .slice(0, 2);
      
      if (topPlatforms.length > 0) {
        recommendations.push(`ğŸš« å»ºè®®å–å…³æˆ–å±è”½ ${getPlatformName(topPlatforms[0])} ä¸Šçš„ç‰¹å®šè´¦å·`);
      }
      
      // åŸºäºå†…å®¹ç±»å‹çš„å»ºè®®
      const contentCounts = {};
      records.forEach(r => {
        r.contentTypes.forEach(type => {
          contentCounts[type] = (contentCounts[type] || 0) + 1;
        });
      });
      
      const topContent = Object.keys(contentCounts)
        .sort((a, b) => contentCounts[b] - contentCounts[a])[0];
      
      if (topContent) {
        recommendations.push(`ğŸ’­ "${topContent}" ç±»å†…å®¹å¯¹ä½ å½±å“è¾ƒå¤§ï¼Œå¯ä»¥ä¸»åŠ¨é¿å…æˆ–è°ƒæ•´å…³æ³¨åˆ—è¡¨`);
      }
      
      // é€šç”¨å»ºè®®
      recommendations.push('ğŸŒ¿ æ¯æ¬¡åˆ·å®Œç¤¾äº¤åª’ä½“åï¼Œåšä¸€æ¬¡"ç¤¾äº¤åª’ä½“æ¸…é†’ç»ƒä¹ "');
      recommendations.push('ğŸ“ å®šæœŸå›é¡¾è¿™äº›è®°å½•ï¼Œæé†’è‡ªå·±ç¤¾äº¤åª’ä½“çš„å†…å®¹ä¸ä»£è¡¨çœŸå®ç”Ÿæ´»');
      
      container.innerHTML = recommendations.map(r => `
        <div class="flex items-start">
          <span class="mr-2">â€¢</span>
          <span>${r}</span>
        </div>
      `).join('');
    }

    function getPlatformName(key) {
      const names = {
        'instagram': 'Instagram',
        'xiaohongshu': 'å°çº¢ä¹¦',
        'douyin': 'æŠ–éŸ³',
        'weibo': 'å¾®åš',
        'bilibili': 'Bç«™',
        'wechat': 'å¾®ä¿¡',
        'facebook': 'Facebook',
        'other': 'å…¶ä»–'
      };
      return names[key] || key;
    }

    // ============================================
    // åŠ è½½å†å²è®°å½•
    // ============================================
    
    function loadHistory() {
      const records = JSON.parse(localStorage.getItem('socialMediaRecords') || '[]');
      const container = document.getElementById('historyList');
      const emptyState = document.getElementById('emptyHistory');
      
      if (records.length === 0) {
        container.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
      }
      
      container.classList.remove('hidden');
      emptyState.classList.add('hidden');
      
      // æŒ‰æ—¶é—´å€’åº
      const sorted = records.sort((a, b) => b.id - a.id);
      
      container.innerHTML = sorted.map(record => {
        const date = new Date(record.date);
        const dateStr = date.toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' });
        const timeStr = date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
        
        return `
          <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-center space-x-2">
                <div class="text-2xl">ğŸ“±</div>
                <div>
                  <div class="font-medium text-gray-800">${getPlatformName(record.platform)}</div>
                  <div class="text-xs text-gray-500">${dateStr} ${timeStr}</div>
                </div>
              </div>
              <button onclick="deleteRecord(${record.id})" class="text-red-500 hover:text-red-700 text-sm">
                <i class="fa fa-trash"></i>
              </button>
            </div>
            
            <div class="mb-3">
              <div class="text-xs text-gray-600 mb-1">å†…å®¹ç±»å‹:</div>
              <div class="flex flex-wrap gap-1">
                ${record.contentTypes.map(type => 
                  `<span class="text-xs bg-gray-100 px-2 py-1 rounded">${type}</span>`
                ).join('')}
              </div>
            </div>
            
            <div class="mb-3">
              <div class="text-xs text-gray-600 mb-1">è§¦å‘çš„æƒ³æ³•:</div>
              <div class="text-sm text-gray-700">${record.automaticThought}</div>
            </div>
            
            <div class="flex items-center justify-between">
              <span class="text-xs text-gray-600">å¹³å‡æƒ…ç»ªå¼ºåº¦</span>
              <span class="text-sm font-bold ${
                parseFloat(record.avgEmotion) >= 7 ? 'text-red-600' : 
                parseFloat(record.avgEmotion) >= 4 ? 'text-orange-600' : 'text-green-600'
              }">${record.avgEmotion}/10</span>
            </div>
          </div>
        `;
      }).join('');
    }

    // ============================================
    // åˆ é™¤è®°å½•
    // ============================================
    
    function deleteRecord(id) {
      if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) return;
      
      try {
        const records = JSON.parse(localStorage.getItem('socialMediaRecords') || '[]');
        const filtered = records.filter(r => r.id !== id);
        localStorage.setItem('socialMediaRecords', JSON.stringify(filtered));
        
        showToast('è®°å½•å·²åˆ é™¤');
        loadHistory();
        
      } catch (error) {
        console.error('åˆ é™¤å¤±è´¥:', error);
        showToast('åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }

    function clearAllRecords() {
      if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;
      
      try {
        localStorage.setItem('socialMediaRecords', '[]');
        showToast('æ‰€æœ‰è®°å½•å·²æ¸…ç©º');
        loadHistory();
        
      } catch (error) {
        console.error('æ¸…ç©ºå¤±è´¥:', error);
        showToast('æ¸…ç©ºå¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }

    // ============================================
    // Toast æç¤º
    // ============================================
    
    function showToast(message) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      toastMessage.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // ============================================
    // é¡µé¢åŠ è½½
    // ============================================
    
    document.addEventListener('DOMContentLoaded', () => {
      showToast('è®°å½•è§¦å‘æ—¶åˆ»ï¼Œäº†è§£ç¤¾äº¤åª’ä½“å¦‚ä½•å½±å“ä½ ');
    });
  </script>

</body>
</html>
